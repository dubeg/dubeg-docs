---
date: 2021-05-20
title: Switches
menu:
    sidebar:
        parent: Networking
---

## General
- VLAN
    + Virtual Local Area Network
    + Uses logical identifiers (1-4000?) for isolating LANs.
    + By default, a switch provides a single network (composed of its ports).
    + If we want to have separate (ie. virtual) networks within a single switch, we use VLANs.
    + In a way, VLANs can be thought of as port groups making up separate LAN networks.
    + Communication between VLANs (from one VLAN to another) can't happen unless routing (IP) is involved.
    + Port-based VLANs
        - A switch is divided into multiple virtual switches.
        - Traffic within VLANs (dispatched within a switch) is untagged.

- Trunk port
    + Port linking to another switch.
    + Uses VLAN tagging to distinguish/dispatch traffic between VLANs.
    + Native VLAN
        - All untagged traffic going through the port is considered part of the Native VLAN, which is user-definable.
    ---
    - A trunk port marks frames with an identifying tag as they exit the port (outbound).
        + Frames are kept in their assigned VLAN.
        + IEEE 802.1Q
            + Most common trunking protocol
            + Adds a tag to the Ethernet frame as it passes through the port.
    - Both trunk ports linking two switches must be in trunk mode (ie. expect tagged frames)
    - If a trunk port receives untagged traffic (inbound), it may ignore or pass through those frames to a user-specified VLAN (Native VLAN).
    - As a tagged frame arrives at the end of the trunk link, its tag is removed & the frame is sent to the correct access port.
        + ie. target device receives untagged traffic.

- Access port
    + Port is assigned to a single VLAN.
        - Either the default VLAN, or a user-defined vlan.
        - The switch knows which ports are part of which VLAN, and so tagging isn't needed here.
    + Tagged traffic is ignored (?)

- 802.1Q: specifies how VLAN tagging is done.




## IEEE 802 1Q: Tagging and Trunking 101
References:
https://www.youtube.com/watch?v=vE5gvbmR8jg
https://www.youtube.com/watch?v=WqAqeS4tDL8


Note:
On Windows, you may be able to setup vlan tagging on a NIC.
Not all NICs support VLAN tagging.
Only in Windows 10, you can set one VLAN tag for a NIC.
```
Set-NetAdapter -Name "Ethernet0" -VlanID <ID>
```


Trunk
- Aka. 802.1q Link
- Aka. trunk link
---
- Provides VLAN ID for frames traversing between two switches.
    + A trunk port adds a VLAN tag to each frames going outbound (to the other switch).

- Ports linking two switches should be in Trunk mode, allow the same trunk IDs.
    + Cisco: named Trunk Ports.
    + Elsewhere: named Tagged Ports.

Trunk Port
- Expects to receive tagged traffic.
- Sends tagged traffic (adds the VLAN tag itself before sending the frame).

Access Port
- Aka. untagged port
- Port that expects and sends traffic without any VLAN tag.
    + In other words, an access port carries traffic only for one VLAN.
- The VLAN to which the port is part of is determined within the Switch, which manages which ports belong to which VLAN.
---
- A computer connected to an Access Port on a switch has no idea about VLANs.
- VLAN management (adding and processing) are a Switch's responsibility.


+ Default VLAN
    - By default, it's set to VLAN 1. 
        + For Cisco, and most other vendors.
    - Unless we assign a port to a specific VLAN, the port belongs to VLAN 1.
    - We cannot change the default VLAN.
    - We cannot delete the default VLAN.
    - Not intended to be used as a data VLAN.
        + Data traffic, such as traffic generated by computers.
    
+ Native VLAN
    - Specific to a trunk port.
    - All traffic from the specified NativeVLAN traverses on a trunk without being tagged.
    - Default: VLAN 1
        + We can set it to VLAN ID.
    - It should be the same on both ends (trunk ports) of a link between switches.
        + Because the traffic is untagged.
    - Cisco switches will detect a NativeVLAN mismatch on a trunk if any, and disable their respective trunk port.
        + That's the result of the CDP process.
        + However, NativeVLANs can be different on both ends of the trunk if need be.
    - Purpose
        + 1. Created for backward compatibility for devices that don't support VLANs.
        + 2. Used by the switch to carry specific control and management protocol traffic like:
            - Cisco Discovery Protocol (CDP),
            - VLAN Trunking Protocol (VTP),
            - Spanning Tree Protocol (STP),
            - LLDP, 
            - ...
        + 3. Also used for VoIP. 
    - Best Practice:
        + Change from VLAN01 to another unused VLAN that matches across all switches.

+ InterVLAN Routing
    - 1. Using a Router.
        + From the switch, we connect a port (Access Mode/Untagged) of each VLAN to a different router interface (port with a specific subnet).
        + In this configuration:
            - Router doesn't have to know about VLANs.
            - Requires as many ports (to the router) as there are VLANs (inconvenient).
    
    + 2. Router-on-a-stick
        + Switch is connected to a router via only one trunk port.
        + In this configuration:
            - Router must know about VLANs.
            - Router setups the connected port with sub interfaces.
                + Each subinterface is configured as a default gateway for each VLAN.

    + 3. Multilayer Switch InterVLAN Routing
        + Requires only a Layer-3 Switch.
            - ie. no need for a router.
        + Switching and Routing is handling by the routing-able Switch.
        + Switch Virtual Interfaces (SVIs)
            - Logical interfaces that can act as gateways and perform routing.
            - They perform like interfaces on a router.
            - Each has an IP address on its own VLAN.
                + Only one SVI per VLAN in the Switch.
            - They are virtual.



## Ethernet
Date: August 4, 2021
Industrial Ethernet 101 with PLC Product Manager, Jeff Southern. 
Topics: ethernet subnetting, VLANS, NAT and network segmentation.
https://www.youtube.com/watch?v=Lcg-7XeBwlo